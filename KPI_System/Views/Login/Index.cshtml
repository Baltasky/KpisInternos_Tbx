@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <base href="../../../" />
    <title>Sistema de Indicadores de Desempeño</title>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="~/Content/Metronic/Logos/logo4.png" />
    <!--begin::Fonts(mandatory for all pages)-->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
    <!--end::Fonts-->
    <!--begin::Global Stylesheets Bundle(mandatory for all pages)-->
    <link href="~/Content/Metronic/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/Metronic/css/style.bundle.css" rel="stylesheet" type="text/css" />
    <!--end::Global Stylesheets Bundle-->
</head>
<body id="kt_body" class="app-blank">

    <style>
        a {
            cursor: pointer;
        }

    </style>

    <script>var defaultThemeMode = "light"; var themeMode; if (document.documentElement) { if (document.documentElement.hasAttribute("data-bs-theme-mode")) { themeMode = document.documentElement.getAttribute("data-bs-theme-mode"); } else { if (localStorage.getItem("data-bs-theme") !== null) { themeMode = localStorage.getItem("data-bs-theme"); } else { themeMode = defaultThemeMode; } } if (themeMode === "system") { themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"; } document.documentElement.setAttribute("data-bs-theme", themeMode); }</script>
    <div class="d-flex flex-column flex-root" id="kt_app_root">
        <div class="d-flex flex-column flex-lg-row flex-column-fluid">
            <div class="d-flex flex-column flex-column-fluid flex-center w-lg-50 p-10">
                <div class="d-flex justify-content-between flex-column-fluid flex-column w-100 mw-450px">
                    <div class="d-flex flex-stack py-2">
                        <div class="me-2"></div>
                    </div>
                    <div class="">
                        <div class="card rounded-3 w-md-550px">
                            <div class="card-body d-flex flex-column ">
                                <div class="d-flex flex-center flex-column-fluid ">
                                    <form id="ValidarLogin" class="form w-100">
                                        <div class="text-center mb-11">
                                            <img alt="Logo" src="~/Content/Metronic/logos/TullBoxLogo.png" style="max-width: 50%;" />
                                        </div>
                                        <div class="fv-row mb-3">
                                            <div class="text-gray-500 fw-semibold fs-7 mb-5">Ingresa tus credenciales:</div>
                                        </div>
                                        <div class="fv-row input-group  mb-3">
                                            <span class="input-group-text" id="basic-addon1">
                                                <i class="far fa-user-circle fs-1x"></i>
                                            </span>
                                            <input id="Usuario" name="Usuario" type="text" class="form-control form-control-sm" placeholder="Correo" aria-label="User" aria-describedby="basic-addon1" list="NombreLista" />
                                        </div>
                                        <div class="position-relative fv-row   mb-5" data-kt-password-meter="true">
                                            <input id="password" name="password" type="password" class="form-control form-control-sm" placeholder="Contraseña" autocomplete="off" />
                                            <span class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2"
                                                  data-kt-password-meter-control="visibility">
                                                <i class="bi bi-eye-slash fs-2">
                                                    <span class="path1"></span><span class="path2">
                                                    </span><span class="path3">
                                                    </span><span class="path4"></span>
                                                </i>
                                                <i class="bi bi-eye fs-2 d-none">
                                                    <span class="path1"></span><span class="path2"></span><span class="path3"></span>
                                                </i>
                                            </span>
                                        </div>
                                        <div class="d-flex flex-stack flex-wrap gap-3 fs-base fw-semibold mb-8">
                                            <div></div>
                                            <!--begin::Link-->
                                            <a class="link-primary" onclick="AbrirModalRecuperarPassword()">
                                                ¿Olvidaste tu contraseña?
                                            </a>
                                            <!--end::Link-->
                                        </div>
                                        <div id="DescMensaje" class="fv-plugins-message-container invalid-feedback mt-0 mb-5">
                                        </div>
                                        <div class="d-grid mb-10">
                                            <button type="submit" id="ButtonLogin" class="btn btn-primary">
                                                <span class="indicator-label">Acceder</span>
                                                <span class="indicator-progress">
                                                    Por favor, espere...
                                                    <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                                </span>
                                            </button>
                                        </div>
                                    </form>
                                </div>
                                <div class="d-flex flex-stack">
                                    <div class="me-10">
                                        <a class="text-gray-800 text-hover-primary">TullBox By SUMIMSA - Un solo proveedor</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="m-0">
                    </div>
                </div>
            </div>
            <div style="background-image: url(Content/SystemPictures/bg11.png)" class="d-none d-lg-flex flex-lg-row-fluid w-50 bgi-size-cover bgi-position-y-center bgi-position-x-start bgi-no-repeat"></div>
        </div>
    </div>

    <div class="modal fade" tabindex="-1" id="ModalRecuperarPassword" data-bs-keyboard="false" data-bs-backdrop="static">
        <div class="modal-dialog" id="BlockChangePass">
            <div class="modal-content">
                <div class="modal-body">
                    <form id="FormRecuperarPassword">
                        <div class="text-center mb-10">
                            <h1 class="text-dark fw-bolder mb-3">
                                Recuperar contraseña
                            </h1>
                            <div class="text-gray-500 fw-semibold fs-6">
                                Ingresa el correo electrónico
                            </div>
                        </div>
                        <div class="fv-row mb-8 fv-plugins-icon-container">
                            <input type="text" placeholder="correo@sumimsa.com.mx" id="email" name="email" autocomplete="off" class="form-control bg-transparent">
                            <div class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback"></div>
                        </div>
                        <div class="d-flex flex-wrap justify-content-center pb-lg-0">
                            <button type="button" id="ButtonRecuperarPassword" class="btn btn-primary me-4">
                                <span class="indicator-label">
                                    Recuperar
                                </span>
                                <span class="indicator-progress">
                                    Loading...    <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                </span>
                            </button>
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>



    <script>var hostUrl = "~/Content/Metronic/";</script>
    <script src="~/Content/Metronic/plugins/global/plugins.bundle.js"></script>
    <script src="~/Content/Metronic/js/scripts.bundle.js"></script>
    <script type="text/javascript" src="~/Scripts/LoginScript.js"></script>

    <script type="text/javascript">
        //@* Block onloader *@
        var BlockChangePass = document.querySelector("#BlockChangePass");
        var BlockModalChangePass = new KTBlockUI(BlockChangePass, {
            message: '<div class="blockui-message"><span class="spinner-border text-primary"></span> Loading...</div>',
        });

         function AbrirModalRecuperarPassword() {
         $('#email').val("");
           $("input").removeClass("is-valid").removeClass("is-invalid");
            $('[data-field]').remove();
             $("#ModalRecuperarPassword").modal("show");
        }

        function RecuperarPassword() {
            var Correo = $('#email').val();

            BlockModalChangePass.block()

            $.ajax({
                type: 'POST',
                url: "/Login/RecuperarPassword",
                data: {
                    Correo: Correo,
                },
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN",
                        $('input:hidden[name="__RequestVerificationToken"]').val());
                },
            }).done(function (result) {
                if (result != null) {
                    if (result == "Correcto")
                    {
                        BlockModalChangePass.release()
                         ButtonRecuperarPassword.disabled = false;
                          $("#ModalRecuperarPassword").modal("hide");
                           Swal.fire({
                            text: "Revisa la bandeja de tu correo.",
                            icon: "success",
                            buttonsStyling: false,
                            allowEscapeKey: false,
                            allowOutsideClick: false,
                            confirmButtonText: "Ok!",
                            customClass: {
                                confirmButton: "btn btn-primary"
                            }
                            }).then((result) => {
                                if (result.isConfirmed) {
                                }
                            });
                    }
                    else
                    {
                            BlockModalChangePass.release()
                            ButtonRecuperarPassword.disabled = false;
                            $("#ModalRecuperarPassword").modal("hide");
                            Swal.fire({
                            text: "El usuario no existe, envía un correo al administrador.",
                            icon: "warning",
                            buttonsStyling: false,
                            allowEscapeKey: false,
                            allowOutsideClick: false,
                            confirmButtonText: "Ok!",
                            customClass: {
                                confirmButton: "btn btn-primary"
                            }
                            }).then((result) => {
                                if (result.isConfirmed) {
                                }
                            });

                    }
                }
            }).fail(function (xhr, status, error) {
                toastr.error("Error de servidor, por favor contacta al administrador!");
                BlockModalChangePass.release()
            })
        }
    </script>
    <script>
        var FormRecuperarPassword = document.getElementById('FormRecuperarPassword');
        var ButtonRecuperarPassword = document.getElementById('ButtonRecuperarPassword');
        var ValidateRecuperarPassword;

        ButtonRecuperarPassword.addEventListener('click', function (e) {

            $("input").removeClass("is-valid").removeClass("is-invalid");
            $('[data-field]').remove();


            ValidateRecuperarPassword = FormValidation.formValidation(
                FormRecuperarPassword,
                {
                    fields: {
                        'email': {
                            validators: {
                                notEmpty: {
                                    message: "El campo es requerido."
                                }
                            }
                        }

                    },

                    plugins: {
                        trigger: new FormValidation.plugins.Trigger(),
                        bootstrap: new FormValidation.plugins.Bootstrap5({
                            rowSelector: '.fv-row',
                            eleInvalidClass: '',
                            eleValidClass: ''
                        })
                    }
                }
            );

            e.preventDefault();
            if (ValidateRecuperarPassword) {
                ValidateRecuperarPassword.validate().then(function (status) {
                    if (status == 'Valid') {
                        ButtonRecuperarPassword.setAttribute('data-kt-indicator', 'on');

                        ButtonRecuperarPassword.disabled = true;
                        setTimeout(function () {
                            ButtonRecuperarPassword.removeAttribute('data-kt-indicator');

                            RecuperarPassword()

                        }, 1000);
                    }
                    else {
                        ButtonRecuperarPassword.setAttribute('data-kt-indicator', 'on');
                        ButtonRecuperarPassword.disabled = true;

                        setTimeout(function () {
                            ButtonRecuperarPassword.removeAttribute('data-kt-indicator');
                            ButtonRecuperarPassword.disabled = false;

                        }, 100);
                    }
                });
            }
        });
    </script>

</body>
</html>